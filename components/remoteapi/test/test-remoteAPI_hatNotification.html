<!--
/*
 //
// BEGIN SONGBIRD GPL
//
// This file is part of the Songbird web player.
//
// Copyright(c) 2005-2007 POTI, Inc.
// http://songbirdnest.com
//
// This file may be licensed under the terms of of the
// GNU General Public License Version 2 (the "GPL").
//
// Software distributed under the License is distributed
// on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either
// express or implied. See the GPL for the specific language
// governing rights and limitations.
//
// You should have received a copy of the GPL along with this
// program. If not, go to http://www.gnu.org/licenses/gpl.html
// or write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
//
// END SONGBIRD GPL
//
 */
-->

<html>
  <head>
    <title>Remote API Test: hat notification</title>
    <script>
      var myDiv;
      var obs;
      
      function load() {
        //document.addEventListener('RemoteAPIPermissionChanged', handleEvent, true);
        document.addEventListener('RemoteAPIPermissionChanged', handleEvent, true);
        //document.addEventListener('RemoteAPIPermissionDenied', handleEvent, true);
        document.addEventListener('RemoteAPIPermissionDenied', handleEvent, true);
        myDiv = document.getElementById("output");

        obs = {
          observe: function ( aSubject, aTopic, aData) {
          textfield.setAttribute("value", aData);
          }
        }

        // Bind it to the value of the dataremote
        songbird.addListener("metadata.artist", obs);
      }

      function unload() {
        //document.removeEventListener('RemoteAPIPermissionChanged', handleEvent, true);
        document.removeEventListener('RemoteAPIPermissionChanged', handleEvent, true);
        //document.removeEventListener('RemoteAPIPermissionDenied', handleEvent, true);
        document.removeEventListener('RemoteAPIPermissionDenied', handleEvent, true);
        
        songbird.removeListener("metadata.artist", obs);
      }

      function handleEvent(aEvent) {
      var msg = "";
        try {
          for (var i in songbird) {
            msg += i + ": " + songbird[i] + "\n";
          }
          alert(msg);
        } catch(e) { dump(e); }
        
        if ( aEvent.type == 'RemoteAPIPermissionDenied' ) {
          msg = "You have opted to not configure Songbird so our webpage can interact " +
                "with it at it's fullest. Please open tools->options and configure the " +
                "RemoteAPI preferences to allow us XYZ permissions. " + 
                "Below are the permissions that were requested.";
                
          myDiv.appendChild( document.createTextNode(msg) );
          
          myDiv.appendChild( document.createElement("br") );
          
          myDiv.appendChild( document.createTextNode(aEvent.category + 
                                                     " ( " + aEvent.categoryID + " ) , " + 
                                                     aEvent.hasAccess));
        }
        else if( aEvent.type == "RemoteAPIPermissionChanged" ) {
          msg = "Thanks! You've granted the following permissions:";
          
          myDiv.appendChild( document.createTextNode(msg) );
          
          myDiv.appendChild( document.createElement("br") );
          
          myDiv.appendChild( document.createTextNode(aEvent.category + 
                                                     " ( " + aEvent.categoryID + " ) , " + 
                                                     aEvent.hasAccess) );
          myDiv.appendChild(document.createElement("br"));
        }
        
        try {
          myDiv.appendChild(document.createTextNode(aEvent.originalTarget.location));
        } catch (e) { }
          
          myDiv.appendChild(document.createElement("br"));
        
        try {
          myDiv.appendChild(document.createTextNode(aEvent.type));
        } catch (e) { }
          
          myDiv.appendChild(document.createElement("br"));
      }
    </script>
  </head>
  <body onload="load();" onunload="unload();"> 
    <div id="output">
    </div>
  </body>
</html>

