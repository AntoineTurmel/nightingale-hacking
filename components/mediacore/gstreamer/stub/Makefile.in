DEPTH     = ../../../..
topsrcdir = @top_srcdir@
srcdir    = @srcdir@
VPATH     = @srcdir@

include $(DEPTH)/build/autodefs.mk

target_name = sbGStreamerStub

CPP_SRCS   = \
      sbGStreamerStub.cpp \
      $(NULL)

CPP_INCLUDES = \
      $(topsrcdir)/components/mediacore/playback/gstreamer/src \
      $(topsrcdir)/components/include \
      $(MOZSDK_INCLUDE_DIR) \
      $(MOZSDK_INCLUDE_DIR)/nspr \
      $(MOZSDK_INCLUDE_DIR)/xpcom \
      $(MOZSDK_INCLUDE_DIR)/string \
      $(MOZSDK_INCLUDE_DIR)/necko \
      $(NULL)

# If this a gstreamer system build, tell the stub loader not to load any
# dependent libraries
ifdef MEDIA_CORE_GST_SYSTEM
  CPP_EXTRA_FLAGS = -DGST_SYSTEM
endif

DYNAMIC_LIB = $(target_name)$(DLL_SUFFIX)

DYNAMIC_LIB_OBJS = $(CPP_SRCS:.cpp=$(OBJ_SUFFIX))

DYNAMIC_LIB_EXTRA_IMPORTS = \
      nspr4 \
      xpcomglue_s \
      xpcom \
      $(NULL)

DYNAMIC_LIB_IMPORT_PATHS = \
      $(MOZSDK_LIB_DIR) \
      $(NULL)

SONGBIRD_COMPONENTS = $(DYNAMIC_LIB) \
                      $(NULL)

include $(topsrcdir)/build/rules.mk

# XXX Note that on a windows debug build, ogg.dll is named ogg_d.dll.  This is
# fixed using a perl script to copy the file and make the change

all:: copy_libs_manifest

copy_libs_manifest:
	$(CYGWIN_WRAPPER) \
          $(PERL) -p -e "s/ogg.dll/ogg$(DEBUG:%=_d).dll/g" \
          $(srcdir)/gst_libs_$(SB_PLATFORM).txt > $(SONGBIRD_COMPONENTSDIR)/gst_libs.txt
.PHONY: copy_libs_manifest
