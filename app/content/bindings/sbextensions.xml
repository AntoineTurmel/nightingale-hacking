<?xml version="1.0"?>
<!--
/*
//
// BEGIN SONGBIRD GPL
// 
// This file is part of the Songbird web player.
//
// Copyright(c) 2006 POTI, Inc.
// http://songbirdnest.com
// 
// This file may be licensed under the terms of of the
// GNU General Public License Version 2 (the "GPL").
// 
// Software distributed under the License is distributed 
// on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either 
// express or implied. See the GPL for the specific language 
// governing rights and limitations.
//
// You should have received a copy of the GPL along with this 
// program. If not, go to http://www.gnu.org/licenses/gpl.html
// or write to the Free Software Foundation, Inc., 
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
// 
// END SONGBIRD GPL
//
 */
-->

<bindings xmlns="http://www.mozilla.org/xbl"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:xbl="http://www.mozilla.org/xbl">

  <binding id="sbextensions" extends="chrome://songbird/content/bindings/drawer.xml#drawer">

    <implementation>

     <constructor>
       this.header.setAttribute("hidden", "true");
       this.parent.setAttribute("class", "");
     </constructor>

      <field name="bundleInterface">null</field>

      <method name="insertDrawerContent">
        <body>
          <![CDATA[
          try
          {
            // Make the extension droplist
            var listbox = document.createElement( "richlistbox" );
            listbox.setAttribute( "sbid", "extensions_list" );
            listbox.setAttribute( "height", this.size );
            listbox.setAttribute("suppressonselect", "true");
            listbox.setAttribute("class", "sb_faceplate");
            
            return listbox;
          }
          catch ( err )
          {
            alert( "insertDrawerContent - " + err );
          }
          return null;
          ]]>
        </body>
      </method>

      <method name="onContentInserted">
        <body>
          <![CDATA[
            this.insertListItems();
          ]]>
        </body>
      </method>

      <method name="insertListItems">
        <body>
          <![CDATA[
          try
          {
            var listbox = document.getAnonymousElementByAttribute( this, 'sbid', 'extensions_list' );
            var n = this.bundleInterface.getNumExtensions();
            for (var i=0;i<n;i++)
            {
              var item = document.createElement( "richlistitem" );
              var checkbox = document.createElement( "checkbox" );
              checkbox.setAttribute("checked", this.bundleInterface.getExtensionInstallState(i));
              item.appendChild(checkbox);
              item.setAttribute("url", this.bundleInterface.getExtensionURL(i));
              var oncommand = { 
                _that: null, 
                _checkbox: null,
                _index: 0,
                handleEvent: function( event ) { this._that.onToggle(this._index, this._checkbox); } 
              } oncommand._that = this; oncommand._checkbox = checkbox; oncommand._index = i;
              checkbox.addEventListener("command", oncommand, true);
              checkbox.setAttribute("label", this.bundleInterface.getExtensionName(i) /*+ " - " + this.bundleInterface.getExtensionDesc(i)*/);
              checkbox.setAttribute("class", "dialog_checkbox dialog_label");
              listbox.appendChild(item);
            }
          }
          catch ( err )
          {
            alert( "insertListItems - " + err );
          }
          ]]>
        </body>
      </method>

      <method name="onToggle">
        <parameter name="index"/>
        <parameter name="checkbox"/>
        <body>
          if (this.bundleInterface) this.bundleInterface.setExtensionInstallState(index, checkbox.checked);
        </body>
      </method>

      <method name="getContentSize">
      <body>
        <![CDATA[
          var n_ext = this.bundleInterface.getNumExtensions();
          return Math.min(4, n_ext) * 20 + ((n_ext <= 4) ? 4 : 0);
        ]]>
      </body>
      </method>
      
    </implementation>
 
  </binding>

</bindings>
