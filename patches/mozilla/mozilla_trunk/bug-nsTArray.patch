Index: xpcom/glue/nsTArray.cpp
===================================================================
RCS file: /cvsroot/mozilla/xpcom/glue/nsTArray.cpp,v
retrieving revision 1.8
diff -u -p -r1.8 nsTArray.cpp
--- xpcom/glue/nsTArray.cpp	30 Aug 2007 16:59:34 -0000	1.8
+++ xpcom/glue/nsTArray.cpp	31 Aug 2007 18:40:11 -0000
@@ -67,7 +67,10 @@ nsTArray_base::EnsureCapacity(size_type 
     return PR_FALSE;
   }
 
-  if (mHdr == &sEmptyHdr) {
+  // XXX Somehow mHdr doesn't always point to the right sEmptyHdr (linking
+  //     problems on OS X in debug builds). We're going to instead check the
+  //     capacity of the header.
+  if (!mHdr->mCapacity) {
     // NS_Alloc new data
     Header *header = static_cast<Header*>
                                 (NS_Alloc(sizeof(Header) + capacity * elemSize));
