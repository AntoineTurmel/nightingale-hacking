Index: netwerk/base/public/nsINetUtil.idl
===================================================================
RCS file: /cvsroot/mozilla/netwerk/base/public/nsINetUtil.idl,v
retrieving revision 1.4
diff -u -8 -p -r1.4 nsINetUtil.idl
--- netwerk/base/public/nsINetUtil.idl	31 May 2006 17:57:13 -0000	1.4
+++ netwerk/base/public/nsINetUtil.idl	20 Apr 2007 16:01:52 -0000
@@ -39,17 +39,17 @@
 
 #include "nsISupports.idl"
 
 interface nsIURI;
 
 /**
  * nsINetUtil provides various network-related utility methods.
  */
-[scriptable, uuid(c2bf4fea-7f9f-44a4-a7e0-8b323fdcc5d5)]
+[scriptable, uuid(7701f947-e4aa-431c-aec6-6bb304193460)]
 interface nsINetUtil : nsISupports
 {
   /**
    * Parse a content-type header and return the content type and
    * charset (if any).
    *
    * @param aTypeHeader the header string to parse
    * @param [out] aCharset the charset parameter specified in the
@@ -68,24 +68,29 @@ interface nsINetUtil : nsISupports
   const unsigned long ESCAPE_XALPHAS = 1;
 
   /** Leave alphanumeric characters intact, convert spaces to '+',
       %XX-escape all others */
   const unsigned long ESCAPE_XPALPHAS = 2;
 
   /** Leave alphanumeric characters and forward slashes intact,
       %XX-escape all others */
-  const unsigned long ESCAPE_URL_PATH = 3;
+  const unsigned long ESCAPE_URL_PATH = 4;
 
   /**
    * escape a string with %00-style escaping
    */
   ACString escapeString(in ACString aString, in unsigned long aEscapeType);
 
   /**
+   * unescape a %00-style escaped string
+   */
+  ACString unescapeString(in ACString aString);
+
+  /**
    * Test whether the given URI's handler has the given protocol flags.
    *
    * @param aURI the URI in question
    * @param aFlags the flags we're testing for.
    *
    * @return whether the protocol handler for aURI has all the flags
    *         in aFlags.
    */
Index: netwerk/base/src/nsIOService.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/base/src/nsIOService.cpp,v
retrieving revision 1.194
diff -u -8 -p -r1.194 nsIOService.cpp
--- netwerk/base/src/nsIOService.cpp	20 Mar 2007 01:58:19 -0000	1.194
+++ netwerk/base/src/nsIOService.cpp	20 Apr 2007 16:01:57 -0000
@@ -940,20 +940,35 @@ nsIOService::TrackNetworkLinkStatusForOf
     return SetOffline(!isUp);
 }
 
 NS_IMETHODIMP
 nsIOService::EscapeString(const nsACString& aString,
                           PRUint32 aEscapeType,
                           nsACString& aResult)
 {
-  NS_ENSURE_ARG_RANGE(aEscapeType, 0, 3);
+  NS_ENSURE_ARG_RANGE(aEscapeType, 0, 4);
 
   nsCAutoString stringCopy(aString);
   nsCString result;
 
   if (!NS_Escape(stringCopy, result, (nsEscapeMask) aEscapeType))
     return NS_ERROR_OUT_OF_MEMORY;
 
   aResult.Assign(result);
 
   return NS_OK;
 }
+
+NS_IMETHODIMP
+nsIOService::UnescapeString(const nsACString& aString, nsACString& aResult)
+{
+  char *str = ToNewCString(aString);
+  
+  if (!str)
+    return NS_ERROR_OUT_OF_MEMORY;
+
+  str = nsUnescape(str);
+  aResult.Assign(str);
+
+  NS_Free(str);
+  return NS_OK;
+}
